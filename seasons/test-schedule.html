---
# Feel free to add content and custom Front Matter to this file.
# To modify the layout, see https://jekyllrb.com/docs/themes/#overriding-theme-defaults

layout: SiteMaster
nav: "1"
#title: "Schedule"
path: "Seasons/Test-Schedule"
breadcrumbs: "1"
---
<button onclick="forceLeagueRefresh()">Refresh Table</button>
<table id=tbl class="break-table"></table>
<script>
const _maxDaysForSubmission = 3;
function forceLeagueRefresh(){
	delLocal("LeagueTable");
	getLeagueTable();
}


function reduceArayByKeys(arr, keysToKeep){ 
	return arr.map(o => keysToKeep.reduce((acc, curr) => {
	  acc[curr] = o[curr];
	  return acc;
	}, {}));
}


var _joinTable = null;
async function getLeagueTable(){
	var _resultsTable = null;
	var _leagueTable = await fetchData("https://docs.google.com/spreadsheets/d/e/2PACX-1vS2lKSaFjfsuZK7Lseo_HsGYhq1VpQQ_qRqntI2NQqc8qlCRAY919Zje_IaCbsorgAgtA-8noCqHyWL/pub?gid=197807890&single=true&output=csv", "CSV", "LeagueTable", (60*60));
	if (_leagueTable != null) {_resultsTable = await fetchData("https://docs.google.com/spreadsheets/d/e/2PACX-1vSfCDBr6vjSUVxA41chCnyUR46oNnPVyzCyS0_NbvLbk_9eh0Got1BPnZkIKmDngC2bp0bshVm3NiK2/pub?gid=1564670715&single=true&output=csv", "CSV", "ResultsTable", (60*60));}
	if (_resultsTable != null){
		_joinTable = _leagueTable.map(a => ({..._resultsTable.find(p => (a["League Year"] === p["League Year"]) && a["League Type"] === p["League Type"] && a["Match Number"] === p["Match Number"]), ...a, "More Details" : "<span onclick='viewMatchDetails(" + a.Date + ")'>Click Here</span>"}));
		var tableBuild = reduceArayByKeys(_joinTable, ['Date', 'Home Team', "Away Team", "League Year", "League Type", "Match Number", "More Details"]);
		createTable(objectToTwodArray(tableBuild),"tbl");
	} else{
		createTable(objectToTwodArray(_leagueTable),"tbl");
	}
}
async function fetchData(URL, dataType, storeDataName, expirySecs){
	storeDataName = storeDataName || "";
	expirySecs = expirySecs || (60*60*24*7);
	var data = null;
	if (storeDataName != ""){
		data = JSON.parse(getLocal(storeDataName));
		if(data != null){
			if(new Date(UTCString(true)).getTime() - new Date(data.dateTime).getTime() > 1000*expirySecs){delLocal(storeDataName); data = null;}
		}
	}
	if(data ==  null){
		var tempData = null;
		var dl = await fetch(URL);
		if(!dl.ok){return null;}
		var processedData = null;
		switch(dataType) {
			case "TXT":
			case "CSV":
				tempData = await dl.text();
				processedData = ((dataType == "CSV") ? csvToObject(tempData) : tempData);
				break;
			default:
				processedData = await dl.text();
		}
		if (storeDataName != ""){
			setLocal(storeDataName, JSON.stringify({"dateTime":UTCString(true),"storedValue":processedData}));	
		}
		return processedData;
	} else{
		return data.storedValue;
	}
}

function csvToObject(dataString) {
  var lines = dataString
    .split(/\n/)
    .map(function(lineStr) {
        return lineStr.split(",");
    });
  
  var keys = lines[0];

  var objects = lines
    .slice(1)
    .map(function(arr) {
      return arr.reduce(function(obj, val, i) {
        obj[keys[i].trim()] = val; 
        return obj;
      }, {});
    });
  
  return objects;//JSON.stringify(objects, null, 2);
}
getLeagueTable();
//
//let result = appointments.map(a => ({...patients.find(p => a.patientId === p.patientId), ...a}));
</script>
