---
# Feel free to add content and custom Front Matter to this file.
# To modify the layout, see https://jekyllrb.com/docs/themes/#overriding-theme-defaults

layout: SiteMaster
nav: "1"
#title: "Schedule"
path: "Seasons/Test-Schedule"
breadcrumbs: "1"
---
<button onclick="forceLeagueRefresh()">Refresh Table</button>
<span class="late">Late Submission</span> <span class="winner">Winner</span> <span class="draw">Draw</span>
<table id=tbl class="break-table"></table>
<style>
	.late{
		background: red;
		color: white;
		padding: 5px;
		font-weight: bold;
	    line-height: 2;
	}
	.winner{
		background: green;
		color: white;
		padding: 5px;
		font-weight: bold;
	    line-height: 2;
	}
	.draw{
		background: yellow;
		color: black;
		padding: 5px;
		font-weight: bold;
		line-height: 2;
	}
</style>
<script>
const _maxDaysForSubmission = 1000*60*60*24*4;
function forceLeagueRefresh(){
	delLocal("LeagueTable");
	delLocal("ResultsTable");
	getLeagueTable();
}

function timestampToDateObj(str){
	var datearr = str.split(" ")[0].split("/");
	var timearr = str.split(" ")[1].split(":");
	return new Date(datearr[2],datearr[1]-1,datearr[0],timearr[0],timearr[1],timearr[2]);
}

//Timestamp	League Year	League Type	Match Number	Home Score	Away Score	MVP	Comments/Additional Details	Match Sheet Photo	Home Team	Away Team	Referee 1	Referee 2	Date	Comment
var _joinTable = null;
async function getLeagueTable(){
	var _resultsTable = null;
	var _leagueTable = await fetchData("https://docs.google.com/spreadsheets/d/e/2PACX-1vS2lKSaFjfsuZK7Lseo_HsGYhq1VpQQ_qRqntI2NQqc8qlCRAY919Zje_IaCbsorgAgtA-8noCqHyWL/pub?gid=197807890&single=true&output=csv", "CSV", "LeagueTable", (60*60));
	if (_leagueTable != null) {
		_resultsTable = await fetchData("https://docs.google.com/spreadsheets/d/e/2PACX-1vSfCDBr6vjSUVxA41chCnyUR46oNnPVyzCyS0_NbvLbk_9eh0Got1BPnZkIKmDngC2bp0bshVm3NiK2/pub?gid=1564670715&single=true&output=csv", "CSV", "ResultsTable", (60*60));
		_joinTable =_resultsTable != null ? leftJoinObjects(_leagueTable, _resultsTable,["League Year","League Type","Match Number"]) : _leagueTable;
		_joinTable.forEach(function(item, index) {
			var MatchDate = timestampToDateObj(item.Date + " 00:00:01").getTime();
			var dateNow = new Date(UTCString(true)).getTime();
			if (item["Timestamp"] !== undefined){
				var SubmitTime = timestampToDateObj(item["Timestamp"]).getTime();
				if ((MatchDate + _maxDaysForSubmission) < SubmitTime){
					item.Date = "<span class='late'>" + item.Date + "</span>";
				}
				if (item["Home Score"] > item["Away Score"]){
					item["Home Team"] = "<span class='winner'>" + item["Home Team"] + "</span>";
				} else if(item["Home Score"] < item["Away Score"]){
					item["Away Team"] = "<span class='winner'>" + item["Away Team"] + "</span>";				
				} else {
					item["Home Team"] = "<span class='draw'>" + item["Home Team"] + "</span>";
					item["Away Team"] = "<span class='draw'>" + item["Away Team"] + "</span>";
				}
				delete item["Timestamp"];
			} else{
				item["Submit Result"] = "https://docs.google.com/forms/d/e/1FAIpQLSe_zCLLs9ADsMD2oUFQ76WKY2ZMayX_5tVO2M4h4FNhK1RhLA/viewform?usp=pp_url&entry.821820740=" + item['League Year'] + "&entry.492201271=" + item['League Type'].replace(' ', '+') + "&entry.1142329140=" + item['Match Number'];
			}
			if (item["Timestamp"] === undefined && ((MatchDate + _maxDaysForSubmission) < dateNow)){
				item.Date = "<span class='late'>" + item.Date + "</span>";
			}
		});
		createTable(objectToTwodArray(_joinTable),"tbl", [{"filterType":"table"},{"colName":"League Year","filterType":"dropdown"},{"colName":"League Type","filterType":"dropdown"},{"colName":"Match Sheet Photo","hide":1,"colType":"maskedurl"},{"colName":"Home Score","hide":1},{"colName":"Away Score","hide":1},{"colName":"MVP","hide":1}
		,{"colName":"Comments/Additional Details","hide":1},{"colName":"Referee 1","hide":1},{"colName":"Referee 2","hide":1},{"colName":"Comment","hide":1},{"colName":"Submit Result","hide":1,"colType":"maskedurl"}]);
	} else {
		getElem('tbl').insertAdjacentHTML("beforebegin", "Error Download Failed");
	}
}


docReady(function () {
	getLeagueTable();
});
</script>
